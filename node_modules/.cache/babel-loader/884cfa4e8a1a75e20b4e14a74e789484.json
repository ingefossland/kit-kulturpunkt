{"ast":null,"code":"import getVCalendar from \"./getVCalendar\";\nimport getICalQuery from \"./getICalQuery\";\nimport moment from \"moment\";\nimport { v4 as uuidv4 } from 'uuid';\nimport _ from \"lodash\";\nexport const getChildEvents = ({\n  child: {\n    uniqueId,\n    content\n  },\n  events = [],\n  programById\n}) => {\n  content && content.calendar && content.calendar.events && content.calendar.events.map((item, index) => {\n    let event = Object.assign({}, item);\n    event.id = item.id || uniqueId + \"-\" + index;\n    event.program = content.program;\n    programById[event.id] = content.program;\n    events.push(event);\n  });\n  return events;\n};\nexport const getEvent = ({\n  formData: {\n    uniqueId,\n    content\n  },\n  query = {}\n}) => {\n  let calendar = {};\n  let eventsById = {};\n  let programById = {\n    [uniqueId]: content.program || {}\n  };\n  const calendarEvents = content.calendar && content.calendar.events;\n\n  if (calendarEvents) {\n    let events = [];\n    content.children && content.children.map(child => {\n      getChildEvents({\n        child,\n        events,\n        programById\n      });\n    });\n    calendarEvents && calendarEvents.map((item, index) => {\n      let event = Object.assign({}, item);\n      event.id = item.id || uniqueId + \"-\" + index;\n      event.program = content.program;\n      programById[event.id] = content.program;\n      events.push(event);\n    });\n    events.length && events.map(({\n      id,\n      ...item\n    }) => {\n      eventsById[id] = item;\n    });\n    const iCal = events.length && getVCalendar({\n      events\n    });\n    calendar = getICalQuery({\n      iCal,\n      query\n    }) || {};\n    calendar = { ...content.calendar,\n      ...calendar,\n      iCal: iCal,\n      events: events,\n      items: calendar.items.map(item => {\n        return { ...eventsById[item.id],\n          ...item\n        };\n      })\n    };\n  }\n\n  return { ...content,\n    calendar: calendar,\n    eventsByDate: calendar.byDate,\n    eventsById: eventsById,\n    programById: programById\n  };\n};\nexport default getEvent;","map":{"version":3,"sources":["/Users/inge/Sites/kit-kulturpunkt/src/utils/getEvent.js"],"names":["getVCalendar","getICalQuery","moment","v4","uuidv4","_","getChildEvents","child","uniqueId","content","events","programById","calendar","map","item","index","event","Object","assign","id","program","push","getEvent","formData","query","eventsById","calendarEvents","children","length","iCal","items","eventsByDate","byDate"],"mappings":"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","sourcesContent":["import getVCalendar from \"./getVCalendar\"\nimport getICalQuery from \"./getICalQuery\"\nimport moment from \"moment\"\nimport { v4 as uuidv4 } from 'uuid';\nimport _ from \"lodash\"\n\nexport const getChildEvents = ({child: { uniqueId, content }, events = [], programById}) => {\n\n    content && content.calendar && content.calendar.events && content.calendar.events.map((item, index) => {\n        let event = Object.assign({}, item)\n        event.id = item.id || uniqueId + \"-\" + index\n        event.program = content.program\n        programById[event.id] = content.program\n        events.push(event)\n    })\n    \n    return events\n\n}\n\nexport const getEvent = ({formData: { uniqueId, content }, query = {}}) => {\n \n    let calendar = {}\n\n    let eventsById = {}\n\n    let programById = {\n        [uniqueId]: content.program || {}\n    }\n\n    const calendarEvents = content.calendar && content.calendar.events\n\n    if (calendarEvents) {\n\n        let events = []\n\n        content.children && content.children.map(child => {\n            getChildEvents({child, events, programById})\n        })\n\n        calendarEvents && calendarEvents.map((item, index) => {\n            let event = Object.assign({}, item)\n            event.id = item.id || uniqueId + \"-\" + index\n            event.program = content.program\n            programById[event.id] = content.program\n            events.push(event)\n        })\n\n        events.length && events.map(({id, ...item}) => {\n            eventsById[id] = item\n        })\n\n        const iCal = events.length && getVCalendar({events})\n\n        calendar = getICalQuery({iCal, query}) || { }\n\n        calendar = {\n            ...content.calendar,\n            ...calendar,\n            iCal: iCal,\n            events: events,\n            items: calendar.items.map(item => { return {...eventsById[item.id], ...item}}),\n        }\n\n    }\n\n    return {\n        ...content,\n        calendar: calendar,\n        eventsByDate: calendar.byDate,\n        eventsById: eventsById,\n        programById: programById,\n    }\n\n}\n\nexport default getEvent"]},"metadata":{},"sourceType":"module"}