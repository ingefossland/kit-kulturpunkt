{"ast":null,"code":"var _jsxFileName = \"/Users/inge/Sites/kit-kulturpunkt/src/components/KpLink/KpLinkField.js\";\nimport React, { Component } from 'react';\nimport Color from 'color';\nimport model from \"./KpLink.model\";\nimport KpLinkContentField from \"./KpLinkContentField\";\nimport { utils } from \"@rjsf/core\";\nconst {\n  getUiOptions,\n  getDefaultFormState\n} = utils;\n\nconst KpLinkField = props => {\n  const {\n    formData,\n    formContext,\n    registry\n  } = props;\n  const schema = { ...model.schema,\n    ...props.schema\n  };\n  const uiSchema = { ...model.uiSchema,\n    ...props.uiSchema\n  };\n  const mediaId = formData && formData.mediaId;\n  const media = formData && formData.media;\n  const referenceId = formData && formData.referenceId;\n  const reference = formData && formData.reference;\n  const referenceTitle = reference && reference.title;\n  const imageUrl = media.imageUrl || reference && reference.imageUrl;\n  const imageFocalpoint = formData && formData.imageFocalpoint;\n  const imageCropdata = formData && formData.imageCropdata;\n  const imageFilters = formData && formData.imageFilters;\n  const backgroundColor = formData && formData.backgroundColor;\n  const color = formData && formData.color;\n\n  const getContrastColor = hex => {\n    const color = Color(hex);\n    return color.isLight() && \"black\" || \"white\";\n  };\n\n  const handleChange = formData => {\n    if (formData.backgroundColor !== backgroundColor) {\n      formData.color = getContrastColor(formData.backgroundColor);\n    }\n\n    if (formData.color !== color) {\n      formData.titleColor = formData.color;\n    }\n\n    const newFormData = getDefaultFormState(schema, formData, registry.definitions);\n    props.onChange && props.onChange(newFormData);\n  };\n\n  const _onMediaChange = ({\n    mediaId,\n    media\n  }) => {\n    console.log('MEDIA change', media);\n    const newFormData = getDefaultFormState(schema, { ...formData,\n      mediaId: mediaId,\n      media: media\n    }, registry.definitions);\n    props.onChange && props.onChange(newFormData);\n  };\n\n  const handleUpload = ({\n    acceptedFiles = []\n  }) => {\n    formContext.onUpload && formContext.onUpload({\n      formContext,\n      schema,\n      onChange: _onMediaChange\n    }, acceptedFiles);\n  };\n\n  const _onMediaDialog = props => {\n    formContext.onDialog && formContext.onDialog({ ...props,\n      schema: {\n        type: \"object\",\n        properties: {\n          mediaId: schema.properties.mediaId,\n          media: schema.properties.media\n        }\n      },\n      formData: {\n        mediaId: mediaId,\n        media: media\n      },\n      onChange: _onMediaChange\n    });\n  };\n\n  const _onReferenceChange = ({\n    referenceId,\n    reference\n  }) => {\n    const newFormData = getDefaultFormState(schema, { ...formData,\n      referenceId: referenceId,\n      reference: reference\n    }, registry.definitions);\n    props.onChange && props.onChange(newFormData);\n  };\n\n  const _onReferenceDialog = props => {\n    formContext.onDialog && formContext.onDialog({ ...props,\n      schema: {\n        type: \"object\",\n        properties: {\n          referenceId: schema.properties.referenceId,\n          reference: schema.properties.reference\n        }\n      },\n      onChange: _onReferenceChange\n    });\n  };\n\n  const handleCropdata = imageCropdata => {\n    props.onChange && props.onChange({ ...formData,\n      imageCropdata: imageCropdata\n    });\n  };\n\n  const handleFocalpoint = imageFocalpoint => {\n    props.onChange && props.onChange({ ...formData,\n      imageFocalpoint: imageFocalpoint\n    });\n  };\n\n  const handleFilters = imageFilters => {\n    props.onChange && props.onChange({ ...formData,\n      imageFilters: imageFilters\n    });\n  };\n\n  const getUiSchema = () => {\n    const uiOptions = getUiOptions(uiSchema);\n    let fieldset = [];\n    const uiPreview = {\n      \"ui:mediaId\": mediaId,\n      \"ui:media\": mediaId,\n      \"ui:referenceId\": referenceId,\n      \"ui:reference\": reference,\n      \"ui:imageUrl\": imageUrl,\n      \"ui:imageCropdata\": imageCropdata,\n      \"ui:imageFilters\": imageFilters,\n      \"ui:imageFocalpoint\": imageFocalpoint,\n      \"ui:onUpload\": handleUpload\n    };\n    let newUiSchema = {};\n\n    if (uiSchema.content) {\n      newUiSchema.content = { ...uiSchema.content,\n        ...uiPreview,\n        \"ui:field\": KpLinkContentField\n        /*\n         \"linkMedia\": {\n            ...uiSchema.link.linkMedia,\n            \"ui:layout\": KpLinkMediaField\n        },\n        \"linkContent\": {\n            ...uiSchema.link.linkContent,\n            \"title\": {\n                ...uiSchema.link.linkContent.title,\n                \"ui:placeholder\": referenceTitle,\n            }\n        }\n        */\n\n      };\n      fieldset.push('content');\n    }\n\n    if (uiSchema.imageCropdata && imageUrl) {\n      newUiSchema.imageCropdata = { ...uiSchema.imageCropdata,\n        ...uiPreview,\n        \"ui:onChange\": cropdata => handleCropdata(cropdata)\n      };\n      fieldset.push('imageCropdata');\n    }\n\n    if (uiSchema.imageFocalpoint && imageUrl) {\n      newUiSchema.imageFocalpoint = { ...uiSchema.imageFocalpoint,\n        ...uiPreview,\n        \"ui:onChange\": focalpoint => handleFocalpoint(focalpoint)\n      };\n      fieldset.push('imageFocalpoint');\n    }\n\n    if (uiSchema.imageFilters && imageUrl) {\n      newUiSchema.imageFilters = { ...uiSchema.imageFilters,\n        ...uiPreview,\n        \"ui:onChange\": filters => handleFilters(filters)\n      };\n      fieldset.push('imageFilters');\n    }\n\n    if (formContext.pageType === \"annotate\") {\n      newUiSchema.imageAnnotations = { ...uiSchema.imageAnnotations,\n        ...uiPreview\n      };\n      fieldset.push('imageAnnotations');\n    }\n\n    return { ...newUiSchema,\n      \"ui:options\": uiOptions,\n      \"ui:fieldset\": fieldset,\n      \"color\": {\n        \"ui:backgroundColor\": formData && formData.backgroundColor\n      },\n      \"link\": { ...newUiSchema.link,\n        \"linkContent\": { ...newUiSchema.content.linkContent,\n          \"titleColor\": {\n            \"ui:backgroundColor\": formData && formData.backgroundColor\n          }\n        }\n      }\n    };\n  };\n\n  const newRegistry = { ...registry,\n    formContext: { ...registry.formContext,\n      \"onUpload\": handleUpload,\n      \"onMediaDialog\": _onMediaDialog,\n      \"onMediaChange\": _onMediaChange,\n      \"onReferenceDialog\": _onReferenceDialog,\n      \"onReferenceChange\": _onReferenceChange\n    }\n  };\n  const newUiSchema = getUiSchema();\n  const {\n    ObjectField\n  } = registry.fields;\n  return /*#__PURE__*/React.createElement(ObjectField, Object.assign({}, props, {\n    uiSchema: newUiSchema,\n    registry: newRegistry,\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 9\n    }\n  }));\n};\n\nexport default KpLinkField;","map":{"version":3,"sources":["/Users/inge/Sites/kit-kulturpunkt/src/components/KpLink/KpLinkField.js"],"names":["React","Component","Color","model","KpLinkContentField","utils","getUiOptions","getDefaultFormState","KpLinkField","props","formData","formContext","registry","schema","uiSchema","mediaId","media","referenceId","reference","referenceTitle","title","imageUrl","imageFocalpoint","imageCropdata","imageFilters","backgroundColor","color","getContrastColor","hex","isLight","handleChange","titleColor","newFormData","definitions","onChange","_onMediaChange","console","log","handleUpload","acceptedFiles","onUpload","_onMediaDialog","onDialog","type","properties","_onReferenceChange","_onReferenceDialog","handleCropdata","handleFocalpoint","handleFilters","getUiSchema","uiOptions","fieldset","uiPreview","newUiSchema","content","push","cropdata","focalpoint","filters","pageType","imageAnnotations","link","linkContent","newRegistry","ObjectField","fields"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Color from 'color';\nimport model from \"./KpLink.model\"\n\nimport KpLinkContentField from \"./KpLinkContentField\"\n\nimport { utils } from \"@rjsf/core\"\nconst { getUiOptions, getDefaultFormState } = utils\n\n\n\nconst KpLinkField = (props) => {\n    const { formData, formContext, registry } = props\n\n\n    const schema = {\n        ...model.schema,\n        ...props.schema\n    }\n\n    const uiSchema = {\n        ...model.uiSchema,\n        ...props.uiSchema\n    }\n\n    const mediaId = formData && formData.mediaId\n    const media = formData && formData.media\n\n    const referenceId = formData && formData.referenceId\n    const reference = formData && formData.reference\n    const referenceTitle = reference && reference.title\n\n    const imageUrl = media.imageUrl || reference && reference.imageUrl;\n    const imageFocalpoint = formData && formData.imageFocalpoint\n    const imageCropdata = formData && formData.imageCropdata\n    const imageFilters = formData && formData.imageFilters\n\n    const backgroundColor = formData && formData.backgroundColor;\n    const color = formData && formData.color;\n\n    const getContrastColor = (hex) => {\n        const color = Color(hex)\n        return color.isLight() && \"black\" || \"white\"\n    }\n\n    const handleChange = (formData) => {\n\n        if (formData.backgroundColor !== backgroundColor) {\n            formData.color = getContrastColor(formData.backgroundColor)\n        }\n\n        if (formData.color !== color) {\n            formData.titleColor = formData.color\n        }\n\n        const newFormData = getDefaultFormState(schema, formData, registry.definitions);\n        props.onChange && props.onChange(newFormData)\n    }\n\n    const _onMediaChange = ({mediaId, media}) => {\n\n        console.log('MEDIA change', media)\n\n        const newFormData = getDefaultFormState(schema, {\n            ...formData,\n            mediaId: mediaId,\n            media: media\n        }, registry.definitions);\n\n        props.onChange && props.onChange(newFormData)\n\n    }\n\n    const handleUpload = ({acceptedFiles = []}) => {\n        formContext.onUpload && formContext.onUpload({formContext, schema, onChange: _onMediaChange}, acceptedFiles)\n    }\n\n    const _onMediaDialog = (props) => {\n\n        formContext.onDialog && formContext.onDialog({\n            ...props,\n            schema: {\n                type: \"object\",\n                properties: {\n                    mediaId: schema.properties.mediaId,\n                    media: schema.properties.media\n                }\n            },\n            formData: {\n                mediaId: mediaId,\n                media: media\n            },\n            onChange: _onMediaChange\n        })\n\n    }\n\n    const _onReferenceChange = ({referenceId, reference}) => {\n\n        const newFormData = getDefaultFormState(schema, {\n            ...formData,\n            referenceId: referenceId,\n            reference: reference\n        }, registry.definitions);\n\n        props.onChange && props.onChange(newFormData)\n\n    }\n\n    const _onReferenceDialog = (props) => {\n\n        formContext.onDialog && formContext.onDialog({\n            ...props,\n            schema: {\n                type: \"object\",\n                properties: {\n                    referenceId: schema.properties.referenceId,\n                    reference: schema.properties.reference\n                }\n            },\n            onChange: _onReferenceChange\n        })\n\n    }\n\n    const handleCropdata = (imageCropdata) => {\n        props.onChange && props.onChange({\n            ...formData,\n            imageCropdata: imageCropdata\n        })\n    }\n\n    const handleFocalpoint = (imageFocalpoint) => {\n        props.onChange && props.onChange({\n            ...formData,\n            imageFocalpoint: imageFocalpoint\n        })\n    }\n\n    const handleFilters = (imageFilters) => {\n        props.onChange && props.onChange({\n            ...formData,\n            imageFilters: imageFilters\n        })\n     }\n    \n    const getUiSchema = () => {\n        const uiOptions = getUiOptions(uiSchema);\n\n        let fieldset = []\n\n        const uiPreview = {\n            \"ui:mediaId\": mediaId,\n            \"ui:media\": mediaId,\n            \"ui:referenceId\": referenceId,\n            \"ui:reference\": reference,\n            \"ui:imageUrl\": imageUrl,\n            \"ui:imageCropdata\": imageCropdata,\n            \"ui:imageFilters\": imageFilters,\n            \"ui:imageFocalpoint\": imageFocalpoint,\n            \"ui:onUpload\": handleUpload,\n        }\n\n        let newUiSchema = {}\n\n        if (uiSchema.content) {\n            newUiSchema.content = {\n                ...uiSchema.content,\n                ...uiPreview,\n\n                \"ui:field\": KpLinkContentField,\n\n                /*\n\n                \"linkMedia\": {\n                    ...uiSchema.link.linkMedia,\n                    \"ui:layout\": KpLinkMediaField\n                },\n                \"linkContent\": {\n                    ...uiSchema.link.linkContent,\n                    \"title\": {\n                        ...uiSchema.link.linkContent.title,\n                        \"ui:placeholder\": referenceTitle,\n                    }\n                }\n                */\n            }\n\n            fieldset.push('content')\n\n        }\n\n        if (uiSchema.imageCropdata && imageUrl) {\n            newUiSchema.imageCropdata = {\n                ...uiSchema.imageCropdata,\n                ...uiPreview,\n                \"ui:onChange\": (cropdata) => handleCropdata(cropdata),\n            }\n\n            fieldset.push('imageCropdata')\n        }\n\n        if (uiSchema.imageFocalpoint && imageUrl) {\n            newUiSchema.imageFocalpoint = {\n                ...uiSchema.imageFocalpoint,\n                ...uiPreview,\n                \"ui:onChange\": (focalpoint) => handleFocalpoint(focalpoint),\n            }\n\n            fieldset.push('imageFocalpoint')\n\n        }\n\n        if (uiSchema.imageFilters && imageUrl) {\n            newUiSchema.imageFilters = {\n                ...uiSchema.imageFilters,\n                ...uiPreview,\n                \"ui:onChange\": (filters) => handleFilters(filters),\n            }\n\n            fieldset.push('imageFilters')\n        }\n\n        if (formContext.pageType === \"annotate\") {\n            newUiSchema.imageAnnotations = {\n                ...uiSchema.imageAnnotations,\n                ...uiPreview\n            }\n\n            fieldset.push('imageAnnotations')\n        }\n\n        return {\n            ...newUiSchema,\n            \"ui:options\": uiOptions,\n            \"ui:fieldset\": fieldset,\n            \"color\": {\n                \"ui:backgroundColor\": formData && formData.backgroundColor\n            },\n            \"link\": {\n                ...newUiSchema.link,\n                \"linkContent\": {\n                    ...newUiSchema.content.linkContent,\n                    \"titleColor\": {\n                        \"ui:backgroundColor\": formData && formData.backgroundColor\n                    }\n                }\n            }\n        }\n\n    }\n\n    const newRegistry = {\n        ...registry,\n        formContext: {\n            ...registry.formContext,\n            \"onUpload\": handleUpload,\n            \"onMediaDialog\": _onMediaDialog,\n            \"onMediaChange\": _onMediaChange,\n            \"onReferenceDialog\": _onReferenceDialog,\n            \"onReferenceChange\": _onReferenceChange\n        }\n    }\n\n    const newUiSchema = getUiSchema()\n\n    const { ObjectField } = registry.fields;\n\n    return (\n        <ObjectField {...props} uiSchema={newUiSchema} registry={newRegistry} onChange={handleChange} />\n    )\n\n}\n\nexport default KpLinkField"]},"metadata":{},"sourceType":"module"}