{"ast":null,"code":"var _jsxFileName = \"/Users/inge/Sites/kit-kulturpunkt/src/Editor/Editor.js\";\nimport React, { useRef, useState, useEffect } from \"react\";\nimport { SchemaBase } from \"@kit-ui/schema\";\nimport { useSelector, useDispatch } from 'react-redux';\nimport { receiveEdit, receiveCurrentId, requestDialog, receiveDialog } from '../redux/editor';\nimport registry from \"../components/registry\";\nimport EditorDialog from \"./EditorDialog\";\nimport EditorPreview from \"./EditorPreview\";\n\nconst Editor = ({\n  schema,\n  uiSchema,\n  onSubmit,\n  ...props\n}) => {\n  const editorRef = useRef(null);\n  const dispatch = useDispatch();\n  const formData = useSelector(state => state.editor.formData);\n  const dialog = useSelector(state => state.editor.dialog);\n\n  const onChange = ({\n    formData\n  }) => {\n    console.log('onChange', formData);\n    dispatch(receiveEdit(formData)); //        setFormData(formData)\n  };\n\n  const [languages, setLanguages] = useState([\"en\"]);\n  const [currentLocale, setCurrentLocale] = useState(null);\n\n  const _onLocale = locale => {}; // defaultId + currentId\n\n\n  const defaultId = props.location.hash && props.location.hash.replace('#', '') || null;\n  const [currentId, setCurrentId] = useState(defaultId);\n\n  const _onCurrentId = currentId => {\n    console.log('editor:onCurrentId', currentId);\n    const hashUrl = props.location.pathname + \"#\" + currentId;\n    setCurrentId(currentId);\n    props.history.replace(hashUrl);\n  };\n\n  const _onToggle = ({\n    id,\n    ...props\n  }) => {\n    console.log('onToggle', props);\n    let parentId = id.split('_');\n    parentId.pop();\n    parentId = parentId.join('_');\n    let expandId = undefined;\n\n    if (id && currentId && currentId.startsWith(id)) {\n      expandId = parentId;\n    } else {\n      expandId = id;\n    }\n\n    _onCurrentId(expandId);\n  };\n\n  const _onSelect = props => {\n    console.log(\"select\", props);\n  };\n\n  const _onExpand = ({\n    id\n  }) => {\n    console.log('onExpand', props);\n\n    _onCurrentId(id);\n  };\n\n  const _onCollapse = ({\n    id\n  }) => {\n    console.log('onCollapse', props);\n\n    _onToggle({\n      id\n    });\n  };\n\n  const _onDialog = ({\n    id,\n    formData,\n    schema,\n    uiSchema,\n    onChange\n  }) => {\n    if (dialog && dialog.id) {\n      dispatch(requestDialog());\n    } else {\n      dispatch(receiveDialog({\n        id: id,\n        expanded: true,\n        formData: formData,\n        schema: schema,\n        uiSchema: uiSchema,\n        onChange: onChange\n      }));\n    }\n  }; // formContext\n\n\n  const formContext = {\n    languages: languages,\n    currentLocale: currentLocale,\n    onLocale: _onLocale,\n    currentId: currentId,\n    onToggle: _onToggle,\n    onExpand: _onExpand,\n    onCollapse: _onCollapse,\n    onEdit: _onExpand,\n    onSave: _onCollapse,\n    onSubmit: status => onSubmit && onSubmit({\n      formData: { ...formData,\n        status: status || formData.status\n      }\n    }),\n    // (e) => editorRef && editorRef.current && editorRef.current.onSubmit(e),\n    preview: {\n      template: props.preview && props.preview.template || EditorPreview,\n      formData: formData,\n      formContext: {\n        currentId,\n        onToggle: _onToggle\n      }\n    },\n    ...props.formContext,\n    onDialog: _onDialog,\n    dialog: { ...dialog,\n      onClose: () => _onDialog({}),\n      template: EditorDialog\n    }\n  };\n  return /*#__PURE__*/React.createElement(SchemaBase, Object.assign({}, registry, {\n    ref: editorRef,\n    schema: schema,\n    uiSchema: uiSchema,\n    formData: formData,\n    formContext: formContext,\n    onChange: onChange,\n    onSubmit: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 9\n    }\n  }));\n};\n\nEditor.defaultProps = {\n  schema: {},\n  formData: {},\n  formContext: {}\n};\nexport default Editor;","map":{"version":3,"sources":["/Users/inge/Sites/kit-kulturpunkt/src/Editor/Editor.js"],"names":["React","useRef","useState","useEffect","SchemaBase","useSelector","useDispatch","receiveEdit","receiveCurrentId","requestDialog","receiveDialog","registry","EditorDialog","EditorPreview","Editor","schema","uiSchema","onSubmit","props","editorRef","dispatch","formData","state","editor","dialog","onChange","console","log","languages","setLanguages","currentLocale","setCurrentLocale","_onLocale","locale","defaultId","location","hash","replace","currentId","setCurrentId","_onCurrentId","hashUrl","pathname","history","_onToggle","id","parentId","split","pop","join","expandId","undefined","startsWith","_onSelect","_onExpand","_onCollapse","_onDialog","expanded","formContext","onLocale","onToggle","onExpand","onCollapse","onEdit","onSave","status","preview","template","onDialog","onClose","defaultProps"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from \"react\"\nimport { SchemaBase } from \"@kit-ui/schema\"\nimport { useSelector, useDispatch } from 'react-redux';\nimport { receiveEdit, receiveCurrentId, requestDialog, receiveDialog } from '../redux/editor';\n\nimport registry from \"../components/registry\"\n\nimport EditorDialog from \"./EditorDialog\"\nimport EditorPreview from \"./EditorPreview\"\n\nconst Editor = ({schema, uiSchema, onSubmit, ...props}) => {\n\n    const editorRef = useRef(null)\n\n    const dispatch = useDispatch()\n\n    const formData = useSelector(state => state.editor.formData)\n    const dialog = useSelector(state => state.editor.dialog)\n\n    const onChange = ({formData}) => {\n        console.log('onChange', formData)\n        dispatch(receiveEdit(formData))\n\n        //        setFormData(formData)\n    }\n\n    const [languages, setLanguages] = useState([\"en\"])\n    const [currentLocale, setCurrentLocale] = useState(null)\n\n    const _onLocale = (locale) => {\n\n    }\n\n    // defaultId + currentId\n\n    const defaultId = props.location.hash && props.location.hash.replace('#','') || null\n\n    const [currentId, setCurrentId] = useState(defaultId)\n\n    const _onCurrentId = (currentId) => {\n        console.log('editor:onCurrentId', currentId);\n        const hashUrl = props.location.pathname + \"#\" + currentId; \n        setCurrentId(currentId)\n        props.history.replace(hashUrl);\n    }\n\n    const _onToggle = ({id, ...props}) => {\n        console.log('onToggle', props)\n\n        let parentId = id.split('_');\n        parentId.pop();\n        parentId = parentId.join('_');\n        \n        let expandId = undefined\n\n        if (id && currentId && currentId.startsWith(id)) {\n            expandId = parentId;            \n        } else {\n            expandId = id;\n        }\n\n        _onCurrentId(expandId)\n\n    }\n    \n    const _onSelect = (props) => {\n        console.log(\"select\", props)\n    }\n\n    const _onExpand = ({id}) => {\n        console.log('onExpand', props)\n        _onCurrentId(id)\n    }\n\n    const _onCollapse = ({id}) => {\n        console.log('onCollapse', props)\n        _onToggle({id})\n    }\n\n    const _onDialog = ({id, formData, schema, uiSchema, onChange}) => {\n\n        if (dialog && dialog.id) {\n            dispatch(requestDialog())\n        } else {\n            dispatch(receiveDialog({\n                id: id,\n                expanded: true,\n                formData: formData,\n                schema: schema,\n                uiSchema: uiSchema,\n                onChange: onChange\n            }))\n        }\n\n    }\n\n    // formContext\n\n    const formContext = {\n        languages: languages,\n        currentLocale: currentLocale,\n        onLocale: _onLocale,\n\n        currentId: currentId,\n        onToggle: _onToggle,\n\n        onExpand: _onExpand,\n        onCollapse: _onCollapse,\n\n        onEdit: _onExpand,\n        onSave: _onCollapse,\n\n        onSubmit: (status) => onSubmit && onSubmit({formData: {...formData, status: status || formData.status}}), // (e) => editorRef && editorRef.current && editorRef.current.onSubmit(e),\n\n        preview: {\n            template: props.preview && props.preview.template || EditorPreview,\n            formData: formData,\n            formContext: {\n                currentId,\n                onToggle: _onToggle\n            }\n        },\n\n\n        ...props.formContext,\n\n        onDialog: _onDialog,\n\n        dialog: {\n            ...dialog,\n            onClose: () => _onDialog({}),\n            template: EditorDialog\n        },\n\n    }    \n\n    return (\n        <SchemaBase\n            {...registry}\n            ref={editorRef}\n            schema={schema}\n            uiSchema={uiSchema}\n            formData={formData}\n            formContext={formContext}\n            onChange={onChange}\n            onSubmit={onSubmit}\n            />\n    )\n\n\n}\n\nEditor.defaultProps = {\n    schema: {},\n    formData: {},\n    formContext: {}\n}\n\nexport default Editor"]},"metadata":{},"sourceType":"module"}