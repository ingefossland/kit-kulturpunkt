{"ast":null,"code":"var _jsxFileName = \"/Users/inge/Sites/kit-kulturpunkt/src/Editor/Editor.js\";\nimport React, { useRef, useState, useEffect } from \"react\";\nimport { SchemaBase } from \"@kit-ui/schema\";\nimport { useHistory } from \"react-router-dom\";\nimport { useSelector, useDispatch } from 'react-redux';\nimport { receiveEdit, receiveCurrentId, requestDialog, receiveDialog } from '../redux/editor';\nimport registry from \"../components/registry\";\nimport EditorDialog from \"./EditorDialog\";\nimport EditorPreview from \"./EditorPreview\";\n\nconst Editor = ({\n  schema,\n  uiSchema,\n  onSubmit,\n  ...props\n}) => {\n  let history = useHistory();\n  const editorRef = useRef(null);\n  const dispatch = useDispatch();\n  const formData = useSelector(state => state.editor.formData);\n  const dialog = useSelector(state => state.editor.dialog);\n  const currentId = useSelector(state => state.editor.currentId);\n\n  const onChange = ({\n    formData\n  }) => {\n    console.log('onChange', formData);\n    dispatch(receiveEdit(formData)); //        setFormData(formData)\n  };\n\n  const [languages, setLanguages] = useState([\"en\"]);\n  const [currentLocale, setCurrentLocale] = useState(null);\n\n  const _onLocale = locale => {}; // hashId toggling\n\n  /*\n   const hashId = props.location.hash && props.location.hash.replace('#','') || null\n   useEffect(() => {\n      dispatch(receiveCurrentId({currentId: hashId}))\n  }, [hashId])\n   */\n\n\n  const _onCurrentId = currentId => {\n    console.log('editor:onCurrentId', currentId);\n    dispatch(receiveCurrentId({\n      currentId: currentId\n    }));\n    const hashUrl = props.location.pathname + \"#\" + currentId;\n    history.push(hashUrl); //        props.history.replace(hashUrl);\n  };\n\n  const _onToggle = ({\n    id,\n    ...props\n  }) => {\n    console.log('onToggle', props);\n    let parentId = id.split('_');\n    parentId.pop();\n    parentId = parentId.join('_');\n    let expandId = undefined;\n\n    if (id && currentId && currentId.startsWith(id)) {\n      expandId = parentId;\n    } else {\n      expandId = id;\n    }\n\n    _onCurrentId(expandId);\n  };\n\n  const _onSelect = props => {\n    console.log(\"select\", props);\n  };\n\n  const _onExpand = ({\n    id\n  }) => {\n    console.log('onExpand', props);\n\n    _onCurrentId(id);\n  };\n\n  const _onCollapse = ({\n    id\n  }) => {\n    console.log('onCollapse', props);\n\n    _onToggle({\n      id\n    });\n  };\n\n  const _onDialog = ({\n    id,\n    formData,\n    schema,\n    uiSchema,\n    onChange\n  }) => {\n    if (dialog && dialog.id) {\n      dispatch(requestDialog());\n    } else {\n      dispatch(receiveDialog({\n        id: id,\n        expanded: true,\n        formData: formData,\n        schema: schema,\n        uiSchema: uiSchema,\n        onChange: onChange\n      }));\n    }\n  }; // formContext\n\n\n  const formContext = {\n    languages: languages,\n    currentLocale: currentLocale,\n    onLocale: _onLocale,\n    currentId: currentId,\n    onToggle: _onToggle,\n    onExpand: _onExpand,\n    onCollapse: _onCollapse,\n    onEdit: _onExpand,\n    onSave: _onCollapse,\n    onSubmit: status => onSubmit && onSubmit({\n      formData: { ...formData,\n        status: status || formData.status\n      }\n    }),\n    // (e) => editorRef && editorRef.current && editorRef.current.onSubmit(e),\n    preview: {\n      template: EditorPreview\n    },\n    ...props.formContext,\n    onDialog: _onDialog,\n    dialog: { ...dialog,\n      onClose: () => _onDialog({}),\n      template: EditorDialog\n    }\n  };\n  return /*#__PURE__*/React.createElement(SchemaBase, Object.assign({}, registry, {\n    ref: editorRef,\n    schema: schema,\n    uiSchema: uiSchema,\n    formData: formData,\n    formContext: formContext,\n    onChange: onChange,\n    onSubmit: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 9\n    }\n  }));\n};\n\nEditor.defaultProps = {\n  schema: {},\n  formData: {},\n  formContext: {}\n};\nexport default Editor;","map":{"version":3,"sources":["/Users/inge/Sites/kit-kulturpunkt/src/Editor/Editor.js"],"names":["React","useRef","useState","useEffect","SchemaBase","useHistory","useSelector","useDispatch","receiveEdit","receiveCurrentId","requestDialog","receiveDialog","registry","EditorDialog","EditorPreview","Editor","schema","uiSchema","onSubmit","props","history","editorRef","dispatch","formData","state","editor","dialog","currentId","onChange","console","log","languages","setLanguages","currentLocale","setCurrentLocale","_onLocale","locale","_onCurrentId","hashUrl","location","pathname","push","_onToggle","id","parentId","split","pop","join","expandId","undefined","startsWith","_onSelect","_onExpand","_onCollapse","_onDialog","expanded","formContext","onLocale","onToggle","onExpand","onCollapse","onEdit","onSave","status","preview","template","onDialog","onClose","defaultProps"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from \"react\"\nimport { SchemaBase } from \"@kit-ui/schema\"\nimport { useHistory } from \"react-router-dom\";\nimport { useSelector, useDispatch } from 'react-redux';\nimport { receiveEdit, receiveCurrentId, requestDialog, receiveDialog } from '../redux/editor';\n\nimport registry from \"../components/registry\"\n\nimport EditorDialog from \"./EditorDialog\"\nimport EditorPreview from \"./EditorPreview\"\n\nconst Editor = ({schema, uiSchema, onSubmit, ...props}) => {\n\n    let history = useHistory();\n\n    const editorRef = useRef(null)\n\n    const dispatch = useDispatch()\n\n    const formData = useSelector(state => state.editor.formData)\n    const dialog = useSelector(state => state.editor.dialog)\n    const currentId = useSelector(state => state.editor.currentId)\n\n    const onChange = ({formData}) => {\n        console.log('onChange', formData)\n        dispatch(receiveEdit(formData))\n\n        //        setFormData(formData)\n    }\n\n    const [languages, setLanguages] = useState([\"en\"])\n    const [currentLocale, setCurrentLocale] = useState(null)\n\n    const _onLocale = (locale) => {\n\n    }\n\n    // hashId toggling\n\n    /*\n\n    const hashId = props.location.hash && props.location.hash.replace('#','') || null\n\n    useEffect(() => {\n        dispatch(receiveCurrentId({currentId: hashId}))\n    }, [hashId])\n\n    */\n\n    const _onCurrentId = (currentId) => {\n        console.log('editor:onCurrentId', currentId);\n        dispatch(receiveCurrentId({currentId: currentId}))\n        const hashUrl = props.location.pathname + \"#\" + currentId; \n        history.push(hashUrl);\n\n//        props.history.replace(hashUrl);\n    }\n\n    const _onToggle = ({id, ...props}) => {\n        console.log('onToggle', props)\n\n        let parentId = id.split('_');\n        parentId.pop();\n        parentId = parentId.join('_');\n        \n        let expandId = undefined\n\n        if (id && currentId && currentId.startsWith(id)) {\n            expandId = parentId;            \n        } else {\n            expandId = id;\n        }\n\n        _onCurrentId(expandId)\n\n    }\n    \n    const _onSelect = (props) => {\n        console.log(\"select\", props)\n    }\n\n    const _onExpand = ({id}) => {\n        console.log('onExpand', props)\n        _onCurrentId(id)\n    }\n\n    const _onCollapse = ({id}) => {\n        console.log('onCollapse', props)\n        _onToggle({id})\n    }\n\n    const _onDialog = ({id, formData, schema, uiSchema, onChange}) => {\n\n        if (dialog && dialog.id) {\n            dispatch(requestDialog())\n        } else {\n            dispatch(receiveDialog({\n                id: id,\n                expanded: true,\n                formData: formData,\n                schema: schema,\n                uiSchema: uiSchema,\n                onChange: onChange\n            }))\n        }\n\n    }\n\n    // formContext\n\n    const formContext = {\n        languages: languages,\n        currentLocale: currentLocale,\n        onLocale: _onLocale,\n\n        currentId: currentId,\n        onToggle: _onToggle,\n\n        onExpand: _onExpand,\n        onCollapse: _onCollapse,\n\n        onEdit: _onExpand,\n        onSave: _onCollapse,\n\n        onSubmit: (status) => onSubmit && onSubmit({formData: {...formData, status: status || formData.status}}), // (e) => editorRef && editorRef.current && editorRef.current.onSubmit(e),\n\n        preview: {\n            template: EditorPreview,\n        },\n\n        ...props.formContext,\n\n        onDialog: _onDialog,\n\n        dialog: {\n            ...dialog,\n            onClose: () => _onDialog({}),\n            template: EditorDialog\n        },\n\n    }    \n\n    return (\n        <SchemaBase\n            {...registry}\n            ref={editorRef}\n            schema={schema}\n            uiSchema={uiSchema}\n            formData={formData}\n            formContext={formContext}\n            onChange={onChange}\n            onSubmit={onSubmit}\n            />\n    )\n\n\n}\n\nEditor.defaultProps = {\n    schema: {},\n    formData: {},\n    formContext: {}\n}\n\nexport default Editor"]},"metadata":{},"sourceType":"module"}