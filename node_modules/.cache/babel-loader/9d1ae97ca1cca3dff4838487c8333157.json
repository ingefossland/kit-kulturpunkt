{"ast":null,"code":"var _jsxFileName = \"/Users/inge/Sites/kit-kulturpunkt/src/components/KpLink/KpLinkField.js\";\nimport React, { Component } from 'react';\nimport Color from 'color';\nimport model from \"./KpLink.model\";\nimport KpLinkContentField from \"./KpLinkContentField\";\nimport { utils } from \"@rjsf/core\";\nconst {\n  getUiOptions,\n  getDefaultFormState\n} = utils;\n\nconst KpLinkField = props => {\n  const {\n    formData,\n    formContext,\n    registry\n  } = props;\n  const schema = { ...model.schema //        ...props.schema\n\n  };\n  const uiSchema = { ...model.uiSchema,\n    ...props.uiSchema\n  };\n  const mediaId = formData && formData.mediaId;\n  const media = formData && formData.media;\n  const referenceId = formData && formData.referenceId;\n  const reference = formData && formData.reference;\n  const referenceTitle = reference && reference.title;\n  const imageUrl = media.imageUrl || referenceId && reference && reference.imageUrl;\n  const imageFocalpoint = formData && formData.imageFocalpoint;\n  const imageCropdata = formData && formData.imageCropdata;\n  const imageFilters = formData && formData.imageFilters;\n  const backgroundColor = formData && formData.backgroundColor;\n  const color = formData && formData.color;\n\n  const getContrastColor = hex => {\n    const color = Color(hex);\n    return color.isLight() && \"black\" || \"white\";\n  };\n\n  const handleChange = formData => {\n    if (formData.backgroundColor !== backgroundColor) {\n      formData.color = getContrastColor(formData.backgroundColor);\n    }\n\n    if (formData.color !== color) {\n      formData.titleColor = formData.color;\n    }\n\n    const newFormData = getDefaultFormState(schema, formData, registry.definitions);\n    props.onChange && props.onChange(newFormData);\n  };\n\n  const handleCropdata = imageCropdata => {\n    props.onChange && props.onChange({ ...formData,\n      imageCropdata: imageCropdata\n    });\n  };\n\n  const handleFocalpoint = imageFocalpoint => {\n    props.onChange && props.onChange({ ...formData,\n      imageFocalpoint: imageFocalpoint\n    });\n  };\n\n  const handleFilters = imageFilters => {\n    props.onChange && props.onChange({ ...formData,\n      imageFilters: imageFilters\n    });\n  };\n\n  const getUiSchema = () => {\n    const uiOptions = getUiOptions(uiSchema);\n    let fieldset = [];\n    const uiPreview = {\n      \"ui:mediaId\": mediaId,\n      \"ui:media\": mediaId,\n      \"ui:referenceId\": referenceId,\n      \"ui:reference\": reference,\n      \"ui:imageUrl\": imageUrl,\n      \"ui:imageCropdata\": imageCropdata,\n      \"ui:imageFilters\": imageFilters,\n      \"ui:imageFocalpoint\": imageFocalpoint\n    };\n    let newUiSchema = {};\n\n    if (uiSchema.content) {\n      newUiSchema.content = { ...uiSchema.content,\n        ...uiPreview,\n        \"ui:field\": KpLinkContentField\n        /*\n         \"linkMedia\": {\n            ...uiSchema.link.linkMedia,\n            \"ui:layout\": KpLinkMediaField\n        },\n        \"linkContent\": {\n            ...uiSchema.link.linkContent,\n            \"title\": {\n                ...uiSchema.link.linkContent.title,\n                \"ui:placeholder\": referenceTitle,\n            }\n        }\n        */\n\n      };\n      fieldset.push('content');\n    }\n\n    if (uiSchema.imageCropdata && imageUrl) {\n      newUiSchema.imageCropdata = { ...uiSchema.imageCropdata,\n        ...uiPreview,\n        \"ui:onChange\": cropdata => handleCropdata(cropdata)\n      };\n      fieldset.push('imageCropdata');\n    }\n\n    if (uiSchema.imageFocalpoint && imageUrl) {\n      newUiSchema.imageFocalpoint = { ...uiSchema.imageFocalpoint,\n        ...uiPreview,\n        \"ui:onChange\": focalpoint => handleFocalpoint(focalpoint)\n      };\n      fieldset.push('imageFocalpoint');\n    }\n\n    if (uiSchema.imageFilters && imageUrl) {\n      newUiSchema.imageFilters = { ...uiSchema.imageFilters,\n        ...uiPreview,\n        \"ui:onChange\": filters => handleFilters(filters)\n      };\n      fieldset.push('imageFilters');\n    }\n\n    if (formContext.pageType === \"annotate\") {\n      newUiSchema.imageAnnotations = { ...uiSchema.imageAnnotations,\n        ...uiPreview\n      };\n      fieldset.push('imageAnnotations');\n    }\n\n    return { ...newUiSchema,\n      \"ui:options\": uiOptions,\n      \"ui:fieldset\": fieldset,\n      \"color\": {\n        \"ui:backgroundColor\": formData && formData.backgroundColor\n      },\n      \"link\": { ...newUiSchema.link,\n        \"linkContent\": { ...newUiSchema.content.linkContent,\n          \"titleColor\": {\n            \"ui:backgroundColor\": formData && formData.backgroundColor\n          }\n        }\n      }\n    };\n  };\n\n  const newUiSchema = getUiSchema();\n  const {\n    ObjectField\n  } = registry.fields;\n  return /*#__PURE__*/React.createElement(ObjectField, Object.assign({}, props, {\n    uiSchema: newUiSchema,\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 9\n    }\n  }));\n};\n\nexport default KpLinkField;","map":{"version":3,"sources":["/Users/inge/Sites/kit-kulturpunkt/src/components/KpLink/KpLinkField.js"],"names":["React","Component","Color","model","KpLinkContentField","utils","getUiOptions","getDefaultFormState","KpLinkField","props","formData","formContext","registry","schema","uiSchema","mediaId","media","referenceId","reference","referenceTitle","title","imageUrl","imageFocalpoint","imageCropdata","imageFilters","backgroundColor","color","getContrastColor","hex","isLight","handleChange","titleColor","newFormData","definitions","onChange","handleCropdata","handleFocalpoint","handleFilters","getUiSchema","uiOptions","fieldset","uiPreview","newUiSchema","content","push","cropdata","focalpoint","filters","pageType","imageAnnotations","link","linkContent","ObjectField","fields"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Color from 'color';\nimport model from \"./KpLink.model\"\n\nimport KpLinkContentField from \"./KpLinkContentField\"\n\nimport { utils } from \"@rjsf/core\"\nconst { getUiOptions, getDefaultFormState } = utils\n\n\n\nconst KpLinkField = (props) => {\n    const { formData, formContext, registry } = props\n\n\n    const schema = {\n        ...model.schema,\n//        ...props.schema\n    }\n\n    const uiSchema = {\n        ...model.uiSchema,\n        ...props.uiSchema\n    }\n\n    const mediaId = formData && formData.mediaId\n    const media = formData && formData.media\n\n    const referenceId = formData && formData.referenceId\n    const reference = formData && formData.reference\n    const referenceTitle = reference && reference.title\n\n    const imageUrl = media.imageUrl || referenceId && reference && reference.imageUrl;\n    const imageFocalpoint = formData && formData.imageFocalpoint\n    const imageCropdata = formData && formData.imageCropdata\n    const imageFilters = formData && formData.imageFilters\n\n    const backgroundColor = formData && formData.backgroundColor;\n    const color = formData && formData.color;\n\n    const getContrastColor = (hex) => {\n        const color = Color(hex)\n        return color.isLight() && \"black\" || \"white\"\n    }\n\n    const handleChange = (formData) => {\n\n        if (formData.backgroundColor !== backgroundColor) {\n            formData.color = getContrastColor(formData.backgroundColor)\n        }\n\n        if (formData.color !== color) {\n            formData.titleColor = formData.color\n        }\n\n        const newFormData = getDefaultFormState(schema, formData, registry.definitions);\n        props.onChange && props.onChange(newFormData)\n    }\n\n\n\n    const handleCropdata = (imageCropdata) => {\n        props.onChange && props.onChange({\n            ...formData,\n            imageCropdata: imageCropdata\n        })\n    }\n\n    const handleFocalpoint = (imageFocalpoint) => {\n        props.onChange && props.onChange({\n            ...formData,\n            imageFocalpoint: imageFocalpoint\n        })\n    }\n\n    const handleFilters = (imageFilters) => {\n        props.onChange && props.onChange({\n            ...formData,\n            imageFilters: imageFilters\n        })\n     }\n    \n    const getUiSchema = () => {\n        const uiOptions = getUiOptions(uiSchema);\n\n        let fieldset = []\n\n        const uiPreview = {\n            \"ui:mediaId\": mediaId,\n            \"ui:media\": mediaId,\n            \"ui:referenceId\": referenceId,\n            \"ui:reference\": reference,\n            \"ui:imageUrl\": imageUrl,\n            \"ui:imageCropdata\": imageCropdata,\n            \"ui:imageFilters\": imageFilters,\n            \"ui:imageFocalpoint\": imageFocalpoint,\n        }\n\n        let newUiSchema = {}\n\n        if (uiSchema.content) {\n            newUiSchema.content = {\n                ...uiSchema.content,\n                ...uiPreview,\n\n                \"ui:field\": KpLinkContentField,\n\n                /*\n\n                \"linkMedia\": {\n                    ...uiSchema.link.linkMedia,\n                    \"ui:layout\": KpLinkMediaField\n                },\n                \"linkContent\": {\n                    ...uiSchema.link.linkContent,\n                    \"title\": {\n                        ...uiSchema.link.linkContent.title,\n                        \"ui:placeholder\": referenceTitle,\n                    }\n                }\n                */\n            }\n\n            fieldset.push('content')\n\n        }\n\n        if (uiSchema.imageCropdata && imageUrl) {\n            newUiSchema.imageCropdata = {\n                ...uiSchema.imageCropdata,\n                ...uiPreview,\n                \"ui:onChange\": (cropdata) => handleCropdata(cropdata),\n            }\n\n            fieldset.push('imageCropdata')\n        }\n\n        if (uiSchema.imageFocalpoint && imageUrl) {\n            newUiSchema.imageFocalpoint = {\n                ...uiSchema.imageFocalpoint,\n                ...uiPreview,\n                \"ui:onChange\": (focalpoint) => handleFocalpoint(focalpoint),\n            }\n\n            fieldset.push('imageFocalpoint')\n\n        }\n\n        if (uiSchema.imageFilters && imageUrl) {\n            newUiSchema.imageFilters = {\n                ...uiSchema.imageFilters,\n                ...uiPreview,\n                \"ui:onChange\": (filters) => handleFilters(filters),\n            }\n\n            fieldset.push('imageFilters')\n        }\n\n        if (formContext.pageType === \"annotate\") {\n            newUiSchema.imageAnnotations = {\n                ...uiSchema.imageAnnotations,\n                ...uiPreview\n            }\n\n            fieldset.push('imageAnnotations')\n        }\n\n        return {\n            ...newUiSchema,\n            \"ui:options\": uiOptions,\n            \"ui:fieldset\": fieldset,\n            \"color\": {\n                \"ui:backgroundColor\": formData && formData.backgroundColor\n            },\n            \"link\": {\n                ...newUiSchema.link,\n                \"linkContent\": {\n                    ...newUiSchema.content.linkContent,\n                    \"titleColor\": {\n                        \"ui:backgroundColor\": formData && formData.backgroundColor\n                    }\n                }\n            }\n        }\n\n    }\n\n    const newUiSchema = getUiSchema()\n\n    const { ObjectField } = registry.fields;\n\n    return (\n        <ObjectField {...props} uiSchema={newUiSchema} onChange={handleChange} />\n    )\n\n}\n\nexport default KpLinkField"]},"metadata":{},"sourceType":"module"}