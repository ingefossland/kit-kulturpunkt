{"ast":null,"code":"export const applyDiscount = ({\n  item,\n  rule,\n  apply\n}) => {\n  const {\n    total,\n    count\n  } = item;\n  const {\n    minPrice,\n    minCount,\n    maxCount\n  } = rule;\n\n  if (minCount && count < minCount) {\n    apply = false;\n  }\n\n  if (maxCount && count > maxCount) {\n    apply = false;\n  }\n\n  if (minPrice && total < minPrice) {\n    apply = false;\n  }\n\n  return apply;\n};\nexport const getCartDiscounts = ({\n  cart,\n  discounts = []\n}) => {\n  const cartItems = cart && cart.items;\n  const cartTotal = cart && cart.total;\n  let items = [];\n  discounts && discounts.map(item => {\n    const {\n      criteria,\n      maxPrice,\n      pctPrice\n    } = item;\n    let apply = true;\n    criteria && criteria.map(rule => {\n      const {\n        id\n      } = rule;\n\n      if (id && cartItems && cartItems[id]) {\n        apply = applyDiscount({\n          item: cartItems[id],\n          rule,\n          apply\n        });\n      } else {\n        apply = applyDiscount({\n          item: cart,\n          rule,\n          apply\n        });\n      }\n    });\n\n    if (apply) {\n      let price;\n\n      if (maxPrice && cartTotal > maxPrice) {\n        price = maxPrice - cartTotal;\n      } else if (cartTotal && pctPrice) {\n        const discount = cartTotal * (pctPrice / 100);\n        price = (cartTotal - discount) * -1;\n      }\n\n      price && items.push({\n        id: item.id,\n        title: item.title,\n        description: item.description,\n        price: price,\n        count: 1,\n        total: price\n      });\n    }\n  });\n  return items;\n};\nexport default getCartDiscounts;","map":{"version":3,"sources":["/Users/inge/Sites/kit-kulturpunkt/src/utils/getCartDiscounts.js"],"names":["applyDiscount","item","rule","apply","total","count","minPrice","minCount","maxCount","getCartDiscounts","cart","discounts","cartItems","items","cartTotal","map","criteria","maxPrice","pctPrice","id","price","discount","push","title","description"],"mappings":"AAAA,OAAO,MAAMA,aAAa,GAAG,CAAC;AAACC,EAAAA,IAAD;AAAOC,EAAAA,IAAP;AAAaC,EAAAA;AAAb,CAAD,KAAyB;AAElD,QAAM;AAAEC,IAAAA,KAAF;AAASC,IAAAA;AAAT,MAAmBJ,IAAzB;AAEA,QAAM;AAAEK,IAAAA,QAAF;AAAYC,IAAAA,QAAZ;AAAsBC,IAAAA;AAAtB,MAAmCN,IAAzC;;AAEA,MAAIK,QAAQ,IAAIF,KAAK,GAAGE,QAAxB,EAAkC;AAC9BJ,IAAAA,KAAK,GAAG,KAAR;AACH;;AAED,MAAIK,QAAQ,IAAIH,KAAK,GAAGG,QAAxB,EAAkC;AAC9BL,IAAAA,KAAK,GAAG,KAAR;AACH;;AAED,MAAIG,QAAQ,IAAIF,KAAK,GAAGE,QAAxB,EAAkC;AAC9BH,IAAAA,KAAK,GAAG,KAAR;AACH;;AAGD,SAAOA,KAAP;AAEH,CArBM;AAuBP,OAAO,MAAMM,gBAAgB,GAAG,CAAC;AAACC,EAAAA,IAAD;AAAOC,EAAAA,SAAS,GAAG;AAAnB,CAAD,KAA4B;AAExD,QAAMC,SAAS,GAAGF,IAAI,IAAIA,IAAI,CAACG,KAA/B;AACA,QAAMC,SAAS,GAAGJ,IAAI,IAAIA,IAAI,CAACN,KAA/B;AAEA,MAAIS,KAAK,GAAG,EAAZ;AAEAF,EAAAA,SAAS,IAAIA,SAAS,CAACI,GAAV,CAAcd,IAAI,IAAI;AAC/B,UAAM;AAAEe,MAAAA,QAAF;AAAYC,MAAAA,QAAZ;AAAsBC,MAAAA;AAAtB,QAAmCjB,IAAzC;AAEA,QAAIE,KAAK,GAAG,IAAZ;AAEAa,IAAAA,QAAQ,IAAIA,QAAQ,CAACD,GAAT,CAAab,IAAI,IAAI;AAE7B,YAAM;AAAEiB,QAAAA;AAAF,UAASjB,IAAf;;AAEA,UAAIiB,EAAE,IAAIP,SAAN,IAAmBA,SAAS,CAACO,EAAD,CAAhC,EAAsC;AAClChB,QAAAA,KAAK,GAAGH,aAAa,CAAC;AAACC,UAAAA,IAAI,EAAEW,SAAS,CAACO,EAAD,CAAhB;AAAsBjB,UAAAA,IAAtB;AAA4BC,UAAAA;AAA5B,SAAD,CAArB;AACH,OAFD,MAEO;AACHA,QAAAA,KAAK,GAAGH,aAAa,CAAC;AAACC,UAAAA,IAAI,EAAES,IAAP;AAAaR,UAAAA,IAAb;AAAmBC,UAAAA;AAAnB,SAAD,CAArB;AACH;AAEJ,KAVW,CAAZ;;AAYA,QAAIA,KAAJ,EAAW;AAEP,UAAIiB,KAAJ;;AAEA,UAAIH,QAAQ,IAAIH,SAAS,GAAGG,QAA5B,EAAsC;AAElCG,QAAAA,KAAK,GAAGH,QAAQ,GAAGH,SAAnB;AAEH,OAJD,MAIO,IAAIA,SAAS,IAAII,QAAjB,EAA2B;AAE9B,cAAMG,QAAQ,GAAGP,SAAS,IAAII,QAAQ,GAAG,GAAf,CAA1B;AACAE,QAAAA,KAAK,GAAG,CAACN,SAAS,GAAGO,QAAb,IAAyB,CAAC,CAAlC;AAEH;;AAEDD,MAAAA,KAAK,IAAIP,KAAK,CAACS,IAAN,CAAW;AAChBH,QAAAA,EAAE,EAAElB,IAAI,CAACkB,EADO;AAEhBI,QAAAA,KAAK,EAAEtB,IAAI,CAACsB,KAFI;AAGhBC,QAAAA,WAAW,EAAEvB,IAAI,CAACuB,WAHF;AAIhBJ,QAAAA,KAAK,EAAEA,KAJS;AAKhBf,QAAAA,KAAK,EAAE,CALS;AAMhBD,QAAAA,KAAK,EAAEgB;AANS,OAAX,CAAT;AASH;AAIJ,GA7CY,CAAb;AA+CA,SAAOP,KAAP;AAEH,CAxDM;AA0DP,eAAeJ,gBAAf","sourcesContent":["export const applyDiscount = ({item, rule, apply}) => {\n\n    const { total, count } = item\n\n    const { minPrice, minCount, maxCount } = rule\n\n    if (minCount && count < minCount) {\n        apply = false\n    }\n\n    if (maxCount && count > maxCount) {\n        apply = false\n    }\n\n    if (minPrice && total < minPrice) {\n        apply = false\n    }\n\n\n    return apply\n\n}\n\nexport const getCartDiscounts = ({cart, discounts = []}) => {\n\n    const cartItems = cart && cart.items\n    const cartTotal = cart && cart.total\n    \n    let items = []\n    \n    discounts && discounts.map(item => {\n        const { criteria, maxPrice, pctPrice } = item\n\n        let apply = true\n\n        criteria && criteria.map(rule => {\n\n            const { id } = rule\n\n            if (id && cartItems && cartItems[id]) {\n                apply = applyDiscount({item: cartItems[id], rule, apply})\n            } else {\n                apply = applyDiscount({item: cart, rule, apply})\n            }\n\n        })\n\n        if (apply) {\n\n            let price\n\n            if (maxPrice && cartTotal > maxPrice) {\n    \n                price = maxPrice - cartTotal\n    \n            } else if (cartTotal && pctPrice) {\n    \n                const discount = cartTotal * (pctPrice / 100)\n                price = (cartTotal - discount) * -1\n    \n            }\n\n            price && items.push({\n                id: item.id,\n                title: item.title,\n                description: item.description,\n                price: price,\n                count: 1,\n                total: price\n            })\n                \n        }\n    \n\n\n    })\n\n    return items\n\n}\n\nexport default getCartDiscounts"]},"metadata":{},"sourceType":"module"}