function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

import React from 'react';
import PropTypes from 'prop-types';
import NavMenuList from "./NavMenuList";
import NavMenuItem from "./NavMenuItem";
import NavMenuLink from "./NavMenuLink";
import NavMenuCalendar from "./NavMenuCalendar";
/** Menu component. Takes */

var NavMenu = function NavMenu(_ref) {
  var className = _ref.className,
      _ref$menu = _ref.menu,
      menu = _ref$menu === void 0 ? [] : _ref$menu,
      menuByUrl = _ref.menuByUrl,
      currentUrl = _ref.currentUrl,
      onSelect = _ref.onSelect,
      onToggle = _ref.onToggle;

  var _onSelect = function _onSelect(item, event) {
    onSelect && onSelect(item);
  };

  var _onToggle = function _onToggle(item, event) {
    onToggle && onToggle(item);
  };

  var renderLink = function renderLink(item) {
    var selected = item.selected,
        url = item.url,
        icon = item.icon,
        title = item.title,
        label = item.label,
        count = item.count;
    return /*#__PURE__*/React.createElement(NavMenuLink, {
      selected: selected,
      url: url,
      icon: icon,
      label: label || title,
      count: count,
      onClick: function onClick(event) {
        return _onSelect(item, event);
      }
    });
  };

  var renderItem = function renderItem(item, index) {
    if (item.url && menuByUrl && menuByUrl[item.url]) {
      item = _extends({}, item, menuByUrl[item.url]);
    }

    if (item.url && currentUrl && item.url === currentUrl) {
      item.expanded = true;
      item.selected = true;
    }

    if (item.url && currentUrl && currentUrl.startsWith(item.url)) {
      item.expanded = true;
    }

    var _item = item,
        role = _item.role,
        calendar = _item.calendar,
        children = _item.children,
        hidden = _item.hidden,
        selected = _item.selected,
        expanded = _item.expanded;

    if (hidden) {
      return /*#__PURE__*/React.createElement(NavMenuItem, {
        key: index,
        role: role
      }, /*#__PURE__*/React.createElement(NavMenuList, {
        role: role
      }, children && children.map(renderItem)));
    }

    if (calendar) {
      return /*#__PURE__*/React.createElement(NavMenuItem, {
        key: index,
        role: role || "treeitem",
        selected: selected,
        expanded: expanded,
        onToggle: function onToggle(event) {
          return _onToggle(item, event);
        }
      }, renderLink(item), expanded && /*#__PURE__*/React.createElement(NavMenuCalendar, calendar));
    }

    if (children) {
      return /*#__PURE__*/React.createElement(NavMenuItem, {
        key: index,
        role: role || "treeitem",
        selected: selected,
        expanded: expanded,
        onToggle: function onToggle(event) {
          return _onToggle(item, event);
        }
      }, renderLink(item), children && expanded && /*#__PURE__*/React.createElement(NavMenuList, {
        role: "tree"
      }, children && children.map(renderItem)));
    }

    return /*#__PURE__*/React.createElement(NavMenuItem, _extends({}, item, {
      key: index,
      role: role || "none"
    }), renderLink(item));
  };

  if (!menu || !menu.length) {
    return false;
  }

  return /*#__PURE__*/React.createElement("nav", {
    className: className
  }, /*#__PURE__*/React.createElement(NavMenuList, {
    role: "tree"
  }, menu.map(renderItem)));
};

NavMenu.defaultProps = {
  menu: [],
  menuByUrl: {}
};
NavMenu.propTypes = process.env.NODE_ENV !== "production" ? {
  /** ClassName */
  className: PropTypes.string,

  /** The menu array */
  menu: PropTypes.array,

  /** Menu items, indexed by url */
  menuByUrl: PropTypes.object,

  /** Current URL selected */
  currentUrl: PropTypes.string,

  /** Select function */
  onSelect: PropTypes.func,

  /** Toggle function */
  onToggle: PropTypes.func
} : {};
export default NavMenu;